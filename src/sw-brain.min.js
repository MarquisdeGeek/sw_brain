self.addEventListener("install",function(e){}),self.addEventListener("fetch",function(e){let t=new URL(e.request.url),r=t.pathname,n=r.substring(r.lastIndexOf("/")+1),a=n.indexOf(".");return-1!==a&&"bf"===n.substr(a+1)?e.respondWith(getBrain(e.request,t)):fetch(e.request)});var bf=function(e,t){var r=[],n=0,a=0,s=-1,c=new Array(3e4),i=0,u=[],l=0;c[0]=0;e:for(;a<e.length;){var f=e[a];if(l>0){switch(f){case"[":l++;break;case"]":l>0&&l--}a++}else{switch(f){case"+":c[i]++;break;case"-":c[i]>0&&c[i]--;break;case">":null==c[++i]&&(c[i]=0);break;case"<":i>0&&i--;break;case",":c[i]=t[n]||-1,n++;break;case".":r.push(c[i]);break;case"[":0!=c[i]?u.push(a):s>-1?(a=s,s=-1):l=1;break;case"]":a=u.pop();continue e}a++}}return r},interface=function(e,t){var r=e.replace(/[^\[\].,><+-]/g,"").split(""),n=t?t.split("").map(function(e){return e.charCodeAt(0)}).filter(function(e){return e>0&&e<256}):[];return bf(r,n)};async function getBrain(e,t){let r=await fetch(e.url);r=(r=await r.text()).trim();const n=t.searchParams,a=n.get("input")||"",s=n.get("output")||"alert";let c=interface(r,a);c=(c=String.fromCharCode.apply(null,c)).trim(),c=JSON.stringify(c).slice(1,-1);let i="";switch(s){case"document":i="document.write('"+c+"')";break;default:i="alert('"+c+"')"}const u=(new TextEncoder).encode(i);let l=new Blob([u.buffer],{type:"text/javascript"});return new Response(l)}